# Checkpoint â€” 2025-10-23 08:25 PT

**Scope**
- Introduced Terraform scaffolding for `staging` (backend template, environment-specific variables, data ECR lookup).
- Injected `ENVIRONMENT` runtime variable so FastAPI health checks reflect deployment env.
- Parameterized GitHub Actions deploy job to respect `environment` input (dynamic working dir, state config).
- Documented staging requirements in `STATE_SETUP.md`, deployment notes, and TODO list.

**Diff highlights**
- `.github/workflows/service.yml`: job-level env config, dynamic paths, `environment_name` var, backend writer reused for staging.
- `infra/terraform/envs/staging/*`: new environment directory with backend example, main.tf, variables.
- `infra/terraform/envs/dev/*`: added `environment_name` wiring and env var injection.
- `infra/terraform/modules/apprunner/main.tf`: added ECR access role + disabled observability.
- `infra/terraform/STATE_SETUP.md`, `service/DEPLOY_NOTES.md`, `docs/agents/todo.md`: staging guidance and new action items.

**Evidence**
- Commits b0bbf4c (`feat(staging): add env config and pipeline support`) and 40be827 (`fix(apprunner): move auth config block`)
- Workflow runs: dev (`18741630014`) and staging (`18753998898`)
- App Runner URLs: dev `https://skcdqfw5pt.us-west-2.awsapprunner.com`, staging `https://pi57pcetyg.us-west-2.awsapprunner.com`
- AWS CLI: `aws dynamodb describe-table dodeck`, `aws dynamodb describe-table dodeck-staging`, `aws apprunner list-services`

**Risks / Follow-ups**
- Deploy IAM inline policy managed manually; migrate into Terraform/IAM module later.
- Monitoring/alerting still outstanding.
