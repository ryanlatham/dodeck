# Checkpoint â€” 2025-10-23 08:25 PT

**Scope**
- Introduced Terraform scaffolding for `staging` (backend template, environment-specific variables, data ECR lookup).
- Injected `ENVIRONMENT` runtime variable so FastAPI health checks reflect deployment env.
- Parameterized GitHub Actions deploy job to respect `environment` input (dynamic working dir, state config).
- Documented staging requirements in `STATE_SETUP.md`, deployment notes, and TODO list.

**Diff highlights**
- `.github/workflows/service.yml`: job-level env config, dynamic paths, `environment_name` var, backend writer reused for staging.
- `infra/terraform/envs/staging/*`: new environment directory with backend example, main.tf, variables.
- `infra/terraform/envs/dev/*`: added `environment_name` wiring and env var injection.
- `infra/terraform/modules/apprunner/main.tf`: added ECR access role + disabled observability.
- `infra/terraform/STATE_SETUP.md`, `service/DEPLOY_NOTES.md`, `docs/agents/todo.md`: staging guidance and new action items.

**Evidence**
- Commit b0bbf4c (`feat(staging): add env config and pipeline support`)
- Workflow run 18741630014 (dev) still passing after changes
- `aws apprunner list-services` shows `dodeck-api`

**Risks / Follow-ups**
- Staging secrets/variables not yet populated; deploy will fail until configured.
- Deploy IAM inline policy managed manually; migrate into Terraform/IAM module later.
- Monitoring/alerting still outstanding.
